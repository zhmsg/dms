{% extends "base.html" %}

{% block title %}查看API解释{% endblock %}

{% block content %}
    <br>
    <a class="btn btn-primary pull-right" href="{{ return_url }}" >API列表</a>
    <a class="btn btn-primary pull-right margin10" href="{{ test_url }}">测试API</a>
    <div id="div_api_new_modify_api" style="display: none">
        <a class="btn btn-primary pull-right margin10" href="{{ batch_test_url }}" >批量测试</a>
        <a class="btn btn-primary pull-right margin10" href="javascript:void(0)" id="a_update_api">修改</a>
    </div>
    <div class="clear"></div>
    <input class="form-control bottom10" id="api_no" value="{{ api_no }}" style="display:none;"/>
    <p>API标题: {{ api_info["basic_info"]["api_title"] }} <a id="link_copy_location" class="status_move">复制文档地址</a></p>
    <p>API URL: {{ api_info["basic_info"]["api_url"] }}</p>
    <p>API 请求方式: {{ api_info["basic_info"]["api_method"] }}</p>
    <p>API 描述: {{ api_info["basic_info"]["api_desc"] }}</p>
    <p>API 状态: {{ api_info["basic_info"]["stage"] }}</p>
    <p>添加时间: {{ api_info["basic_info"]["add_time"] }}</p>
    <p>最近更新时间: {{ api_info["basic_info"]["update_time"] }}</p>
    {% if api_info["header_info"] | length > 0 or api_info["predefine_param"]["header"] | length > 0 %}
        <table class="table table-bordered api-list-table" id="api_header_param">
            <caption>请求头部参数</caption>
            <tr>
                <th scope="col" width="15%">参数名称</th>
                <th class="text-center" scope="col" width="8%">是否必须</th>
                <th scope="col" width="77%">参数描述</th>
            </tr>
            {#    加载预定义头部参数描述#}
            {% for item in api_info["predefine_param"]["header"] %}
                {% if item in api_info["predefine_header"] %}
                    <tr>
                        <td>{{ api_info["predefine_header"][item]["param"] }}</td>
                        <td class="text-center">
                            {% if api_info["predefine_header"][item]["necessary"] %}
                                是
                            {% else %}
                                否
                            {% endif %}
                        </td>
                        <td>{{ api_info["predefine_header"][item]["param_desc"] }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            {% for item in api_info["header_info"] %}
                <tr>
                    <td>{{ item["param"] }}</td>
                    <td class="text-center">
                        {% if item["necessary"] %}
                            是
                        {% else %}
                            否
                        {% endif %}
                    </td>
                    <td>{{ item["param_desc"] }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}
    {% if api_info["body_info"] | length > 0 or api_info["predefine_param"]["body"] | length > 0 %}
        <table class="table table-bordered api-list-table" id="api_body_param">
            <caption>请求主体参数</caption>
            <tr>
                <th scope="col" width="15%">参数名称</th>
                <th class="text-center" scope="col" width="8%">是否必须</th>
                <th class="text-center" scope="col" width="10%">参数类型</th>
                <th scope="col" width="67%">参数描述</th>
            </tr>
            {#    加载预定义头部参数描述#}
            {% for item in api_info["predefine_param"]["body"] %}
                {% if item in api_info["predefine_body"] %}
                    <tr>
                        <td>{{ api_info["predefine_body"][item]["param"] }}</td>
                        <td class="text-center">
                            {% if api_info["predefine_body"][item]["necessary"] %}
                                是
                            {% else %}
                                否
                            {% endif %}
                        </td>
                        <td class="text-center">{{ api_info["predefine_body"][item]["type"] }}</td>
                        <td>{{ api_info["predefine_body"][item]["param_desc"] }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            {% for item in api_info["body_info"] %}
                <tr>
                    <td>{{ item["param"] }}</td>
                    <td class="text-center">
                        {% if item["necessary"] %}
                            是
                        {% else %}
                            否
                        {% endif %}
                    </td>
                    <td class="text-center">{{ item["type"] }}</td>
                    <td>{{ item["param_desc"] }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}
    {% if api_info["input_info"] | length > 0 %}
        <div class="bottom20 api-example">
            <b>请求示例</b>

            <div id="api_input_exist">
                {% for item in api_info["input_info"] %}
                    <div>
                        <p>{{ item["input_desc"] }}</p>

                        <p><textarea class="form-control" readonly>{{ item["input_example"] }}</textarea></p>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
    {% if api_info["output_info"] | length > 0 %}
        <div class="bottom20 api-example">
            <b>返回示例</b>

            <div id="api_output_exist">
                {% for item in api_info["output_info"] %}
                    <p>{{ item["output_desc"] }}</p>
                    <p><textarea class="form-control" readonly>{{ item["output_example"] }}</textarea></p>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <div class="care">
        <input id="care_url" value='{{ url_prefix }}/care/' style="display: none"/>
        <button class="btn btn-primary pull-right" onclick="change_care();" id="make_care">关注</button>
        <p><b>已关注的人(如果您使用到该API，请关注，以便API一旦发生更改，能尽快通知您。)</b></p>
        <label style="display: none" id="lab_care_info">{{ api_info["care_info"] | tojson | safe }}</label>

        <div id="api_care_user">
        </div>
    </div>

    <input id="del_api_url" value="{{ url_prefix }}/basic/" style="display: none" />
    <button id="btn_del_api" class="btn btn-primary pull-right" style="display: none">删除API</button>

    <br>
    <a href="{{ status_url }}?api_no={{ api_no }}" title="">查看所有返回状态码解释</a>
    <label style="display: none" id="role_value">{{ role_value | tojson | safe }}</label>
    {{ 't_js/API_HELP/show_api.js' | make_static_html | safe }}
{% endblock %}