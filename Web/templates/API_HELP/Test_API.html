{% extends "base.html" %}

{% block title %}测试API{% endblock %}


{% block content %}
    <br>
    <a class="btn btn-primary pull-right" href="{{ api_info_url }}?api_no={{ api_no }}" title="">API信息</a>
    <div class="margin20 apiTest">
        <p id="p_env">
            <label class="display_none" id="lab_env_data">{{ module_test_env | tojson | safe }}</label>
            <input class="display_none" id="test_env" :value="use_env"/>

            <template v-if="custom_env">
                <span class="pull-left text-right width150">自定义环境：</span>
                <input class="form-control pull-left bug-input" id="i_test_env" v-model.trim="use_env"/>
            </template>
            <template v-else>
                <span class="pull-left text-right width150">服务环境：</span>
                <select class="form-control pull-left bug-input" id="s_test_env" v-model="use_env">
                    <option v-for="env in all_env" :value="env.env_address">{{env["env_name"]}}</option>
                </select>
            </template>
            <span class="pull-left"><input type="checkbox" v-model="custom_env"/> 自定义</span>
            <span class="clear"></span>
        </p>
        <p>
            <span class="pull-left text-right width150">API模块：</span>
            <select class="form-control bug-input">
                <option>{{ api_info["basic_info"]["module_name"] }}</option>
            </select>
        </p>
        <p>
            <span class="pull-left text-right width150">API列表：</span>
            <select class="form-control pull-left bug-input" id="api_url">
                <option value="{{ api_info["basic_info"]["api_url"] }}">{{ api_info["basic_info"]["api_title"] }}</option>
            </select>
            <input value="{{ api_info["basic_info"]["api_method"] }}" id="api_method" style="display: none"/>
            <span class="pull-left">请求方法： {{ api_info["basic_info"]["api_method"] }}</span>
            <span class="clear"></span>
        </p>
        <p>
            <span class="pull-left text-right width150">请求URL：</span>
            <input class="form-control bug-input" id="request_url" readonly/>
        </p>
        {% if url_param_info | length > 0 %}
            <p>URL参数列表:</p>
            {% for item in url_param_info %}
                <div class="paramListMode">
                    <ul>
                        <li class="star">*</li>
                        <li name="param">{{ item["param_name"] }}</li>
                        <li>：</li>
                        <li><input class="form-control bug-input" id='url_value_{{ item["param_name"] }}'
                                   onkeyup="update_request_url();" origin_param="{{ item["origin_param"] }}"/></li>
                        <div class="clear"></div>
                    </ul>
                    <p>输入{{ item["param_type"] }}类型</p>
                </div>
            {% endfor %}
        {% endif %}
        <p>参数列表:</p>
        {% for item in api_info["predefine_param"]["header"] %}
            {% if item in api_info["predefine_header"] %}
                <div class="paramListMode">
                    <ul>
                        <li class="star">{% if api_info["predefine_header"][item]["necessary"] == true %}
                            * {% endif %}</li>
                        <li name="param">{{ api_info["predefine_header"][item]["param"] }}</li>
                        <li>：</li>
                        <li><input class="form-control bug-input"
                                   id="{{ api_info["predefine_header"][item]["param"] }}_value" param_type="header"/>
                        </li>
                        <div class="clear"></div>
                    </ul>
                    <p>{{ api_info["predefine_header"][item]["param_desc"] }}</p>
                </div>
            {% endif %}
        {% endfor %}
        {% for param_info in api_info["header_info"] %}
            <div class="paramListMode">
                <ul>
                    <li class="star">{% if param_info["necessary"] == true %}* {% endif %}</li>
                    <li name="param">{{ param_info["param"] }}</li>
                    <li>：</li>
                    <li><input class="form-control bug-input" id="{{ param_info["param"] }}_value" param_type="header"/>
                    </li>
                    <div class="clear"></div>
                </ul>
                <p>{{ param_info["param_desc"] }}</p>
            </div>
        {% endfor %}
        {% for item in api_info["predefine_param"]["body"] %}
                {% if item in api_info["predefine_body"] %}
                    <div class="paramListMode">
                        <ul>
                            <li class="star">{% if api_info["predefine_body"][item]["necessary"] == true %}
                                * {% endif %}</li>
                            <li name="param">{{ api_info["predefine_body"][item]["param"] }}</li>
                            <li>：</li>
                            <li>
                                <input class="form-control bug-input"  id="{{ api_info["predefine_body"][item]["param"] }}_value" param_type="body" type="{{ api_info["predefine_body"][item]["type"] }}"/>
                            </li>
                            <li>
                                <select class="form-control" id="{{ api_info["predefine_body"][item]["param"] }}_type" name="body_param_type_{{ api_info["predefine_body"][item]["type"] }}" {% if not new_right %}disabled {% endif %}>
                                    <option value="string">string</option>
                                    <option value="int">int</option>
                                    <option value="list">list</option>
                                    <option value="object">object</option>
                                    <option value="bool">bool</option>
                                </select>
                            </li>
                            <div class="clear"></div>
                        </ul>
                        <p>【{{ api_info["predefine_body"][item]["type"] }}】{{ api_info["predefine_body"][item]["param_desc"] }}</p>
                    </div>
                {% endif %}
            {% endfor %}
        {% for param_info in api_info["body_info"] %}
            {% if param_info["status"] < 3 %}
            <div class="paramListMode">
                <ul>
                    <li class="star">{% if param_info["necessary"] == true %}* {% endif %}</li>
                    <li name="param">{{ param_info["param"] }}</li>
                    <li>：</li>
                    <li>
                        <input class="form-control bug-input" id="{{ param_info["param"] }}_value" param_type="body" type="{{ param_info["type"] }}"/></li>
                    <li>
                        <select class="form-control" id="{{ param_info["param"] }}_type" name="body_param_type_{{ param_info["type"] }}" {% if not new_right %}disabled {% endif %}>
                            <option value="string">string</option>
                            <option value="int">int</option>
                            <option value="list">list</option>
                            <option value="object">object</option>
                            <option value="bool">bool</option>
                        </select>
                    </li>
                    <div class="clear"></div>
                </ul>
                <p>【{{ param_info["type"] }}】{{ param_info["param_desc"] }}</p>
            </div>
            {% endif %}
        {% endfor %}
        <p>
            <button class="btn btn-primary" onclick="test_api()">检查</button>
            <button class="btn btn-primary" id="btn_generating_code">Python</button>
            <input class="box-side width300" id="test_case_name" type="text" placeholder="请输入测试用例的名称" style="display: none"/>
            <input class="box-side width100" id="expect_status" type="text" placeholder="期待状态码" style="display: none"/>
            <button class="btn btn-primary" id="btn_save_case" value="保存测试用例">保存测试用例</button>
        </p>
        <div id="div_test_case">

        </div>
        <textarea class="form-control font16" rows="20" cols="120" id="res_text" readonly></textarea>

    </div>
    <div class="apiContentLine bottom10">
        <textarea class="box-side" id="output_desc" placeholder="返回示例描述" rows="3" style="display: none"></textarea>
        <button class="btn btn-primary" id="btn_save_output" value="保存成返回示例" style="display: none">保存成返回示例</button>
    </div>
    <input class="box-side width300" id="save_name" type="text" placeholder="请输入保存的名称" style="display: none"/>
    <button class="btn btn-primary" id="btn_save_result" value="保存结果" style="display: none">保存结果</button>
    <div class="top6">
        <a id="look_status" href="{{ status_url }}?api_no={{ api_no }}" title="{{ status_url }}?api_no={{ api_no }}">查看返回状态码解释</a>
    </div>
    <input id="test_case_url" value="{{ test_case_url }}" style="display: none">
    <input id="api_example_url" value="{{ api_example_url }}" style="display: none">
    <input id="new_right" value="{{ new_right }}" style="display: none">
    </div>
    {{ 't_js/Common/base64.js' | make_static_html | safe }}
    {{ 't_js/Common/download_json.js' | make_static_html | safe }}
    {{ 't_js/API_HELP/test_api.js' | make_static_html | safe }}
    {{ 't_js/API_HELP/test_api_data.js' | make_static_html | safe }}
{% endblock %}

