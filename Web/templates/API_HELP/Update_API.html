{% extends "base.html" %}

{% block title %}更新API解释{% endblock %}

{% block js_content %}
    {{ 't_js/Common/add_node.js' | make_static_html | safe }}
    {{ 't_js/bootstrap.min.js' | make_static_html | safe }}
    {{ 't_js/API_HELP/update_api.js' | make_static_html | safe }}

{% endblock %}

{% block content %}
    <br>
    <a class="btn btn-primary pull-right" href="{{ return_url }}" title="">返回</a>
    <input id="api_no" value="{{ api_no }}" style="display:none;"/>
    <p>API标题: <span id="span_api_title"></span></p>
    <p>API URL: <span id="span_api_url"></span></p>
    <p>API 请求方式: <span id="span_api_method"></span></p>
    <p>API 描述: <span id="span_api_desc"></span></p>
    <p>API 状态: <span id="span_stage"></span></p>
    <p>添加时间: <span id="span_add_time"></span></p>
    <p>最近更新时间: <span id="span_update_time"></span></p>
    <a href="{{ url_prefix }}/basic/?api_no={{ api_no }}">更新API信息</a>
    <span class="margin10" id="span_modify_stage">

    </span>

    <input id="del_header_url" value="{{ url_prefix }}/header/" style="display: none" />
    <input id="del_body_url" value="{{ url_prefix }}/body/" style="display: none" />
    <input id="del_input_url" value="{{ url_prefix }}/input/" style="display: none" />
    <input id="del_output_url" value="{{ url_prefix }}/output/" style="display: none" />
    <table class="table table-bordered api-list-table" id="api_header_param">
        <caption>请求头部参数</caption>
        <tr>
            <th scope="col" width="25%">参数名称</th>
            <th scope="col" width="8%">是否必须</th>
            <th scope="col" width="55%">参数描述</th>
            <th scope="col" width="12%">操作</th>
        </tr>
        {% for item in api_info["header_info"] %}
        <tr id="tr_{{ item["api_no"] }}{{ item["param"] }}">
            <td>{{ item["param"] }}</td>
            <td>
                <select class="form-control" disabled>
                    <option value="1" {% if item["necessary"] %}selected="selected"{% endif %}>是</option>
                    <option value="0" {% if not item["necessary"] %}selected="selected"{% endif %}>否</option>
                </select>
            </td>
            <td>{{ item["param_desc"] }}</td>
            <td>
                <button class="btn btn-success">更新</button>
                <button class="btn btn-danger" onclick="delete_header_param('{{ item["api_no"] }}','{{ item["param"] }}')">删除</button>
            </td>
        </tr>
        {% endfor %}
            <td><input class="form-control" id="header_param_name"/></td>
            <td>
                <select class="form-control" id="header_param_necessary">
                    <option value="1">是</option>
                    <option value="0">否</option>
                </select>
            </td>
            <td><input class="form-control" id="header_param_desc" placeholder="如果你不想既浪费了写文档的时间，还得浪费时间给前端解释。请写的傻子都能看懂" /></td>
            <td><button class="btn btn-info" onclick="add_api_info('header');">新建</button></td>

    </table>
    {% for item in api_info["predefine_header"] %}
        {% if item in api_info["predefine_param"]["header"] %}
            <button id="pp_{{ item }}" class="btn btn-danger" onclick="handle_predefine_param(this.id, 'header');" title="{{ api_info["predefine_header"][item]["param_desc"] }}" value="{{ item }}">不需要{{ item }}</button>
        {% else %}
            <button id="pp_{{ item }}" class="btn btn-info" onclick="handle_predefine_param(this.id, 'header');" title="{{ api_info["predefine_header"][item]["param_desc"] }}" value="{{ item }}">需要{{ item }}</button>
        {% endif %}
    {% endfor %}
    <table class="table table-bordered api-list-table" id="api_body_param">
        <caption>请求主体参数</caption>
        <tr>
            <th scope="col" width="15%">参数名称</th>
            <th scope="col" width="8%">是否必须</th>
            <th scope="col" width="9%">参数类型</th>
            <th scope="col" width="45%">参数描述</th>
            <th scope="col" width="10%">生效</th>
            <th scope="col" width="12%">操作</th>
        </tr>
        <tr>
        <td><input class="form-control" id="body_param_name"/></td>
        <td>
            <select class="form-control" id="body_param_necessary">
                <option value="1">是</option>
                <option value="0">否</option>
            </select>
        </td>
        <td>
            <select class="form-control" id="body_param_type">
                <option value="string">string</option>
                <option value="int">int</option>
                <option value="list">list</option>
                <option value="object">object</option>
                <option value="bool">bool</option>
            </select>
        </td>
        <td><input class="form-control" id="body_param_desc" placeholder="请详细的描述出后端对参数的限制，包括但不限于字段长度，字符限制等" /></td>
        <td>
            <select class="form-control" id="body_param_status">
                <option value="1" title="立即生效">立即</option>
                <option value="0" title="稍后生效">稍后</option>
                <option value="2" title="待废弃">待废弃</option>
                <option value="3" title="已废弃">已废弃</option>
            </select>
        </td>
        <td><button class="btn btn-info" id="btn_new_body" onclick="add_api_info('body');">新建</button></td>
        </tr>
    </table>
    {% for item in api_info["predefine_body"] %}
        {% if item in api_info["predefine_param"]["body"] %}
            <button id="pp_{{ item }}" class="btn btn-danger" onclick="handle_predefine_param(this.id, 'body');" title="{{ api_info["predefine_body"][item]["param_desc"] }}" value="{{ item }}">不需要{{ item }}</button>
        {% else %}
            <button id="pp_{{ item }}" class="btn btn-info" onclick="handle_predefine_param(this.id, 'body');" title="{{ api_info["predefine_body"][item]["param_desc"] }}" value="{{ item }}">需要{{ item }}</button>
        {% endif %}
    {% endfor %}
    <a href="{{ url_prefix }}/body/?api_no={{ api_no }}">从其他API复制</a>
    <br>
    <div class="bottom20 top6 api-example">
        <b>请求示例</b>
        <div id="api_input_exist">
        </div>
        <div>
            <input name="url" value="{{ url_prefix }}/example/" class="display_none"/>
            <input name="example_type" value="1" class="display_none"/>

            <p><input class="form-control" name="desc" placeholder="请求示例描述"/></p>

            <p><textarea class="form-control input_example" name="content" onchange="format_input(this.id);"
                         onkeyup="format_input(this.id);" placeholder="请求示例，写成符合json格式。解释示例，请在描述中解释"></textarea></p>
            <button class="btn btn-info" name="btn_new">新建</button>
        </div>
    </div>

    <div class="bottom20 api-example">
        <b>返回示例</b>
        <div id="api_output_exist">
        </div>
        <div>
            <input name="url" value="{{ url_prefix }}/example/" class="display_none"/>
            <input name="example_type" value="2" class="display_none"/>

            <p><input class="form-control" name="desc" placeholder="返回示例描述"/></p>

            <p><textarea class="form-control input_example" name="content" onchange="format_input(this.id);"
                         onkeyup="format_input(this.id);"
                         placeholder="返回示例，写成符合json格式。解释示例，请在描述中解释。所有完成后请将API状态置为完成"></textarea></p>
            <button class="btn btn-info" name="btn_new">新建</button>
        </div>
    </div>
    <input id="url_prefix" value="{{ url_prefix }}" style="display: none">
    <input id="update_stage_url" value="{{ update_stage_url }}" style="display: none">

{% endblock %}